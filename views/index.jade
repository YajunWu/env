extends layout

block content
  h1= title
  .container
    .row
      .col-md-12
        h3 读取vhost
        textarea.form-control(id='J_httpd',rows='10',cols='100')  
    //- .box
    //-   h3 读取vhost
    //-   textarea.form-control(id='J_httpd',rows='10',cols='100')
    form.form-horizontal(action="/api/vhost/", method='post').box
      h3 添加vhost
      .form-group
        label.control-label.col-md-2 Name
        .col-md-6
          input.form-control(type='text', name='name', autofocus)
      .form-group
        label.control-label.col-md-2 Root
        .col-md-6
          input.form-control(type='text', name='root')
      .form-group
        .col-md-6.col-md-offset-2
          input.form-control(type='text', name='proxy', value='[{"path":"/","proxy":"http://127.0.0.1:3000/"},{"path":"/js","proxy":"http://127.0.0.1:3000/js"}]')  
      .form-group
        .col-md-6.col-md-offset-2
          input.btn.btn-primary(type='submit')
      
    .box
      button.btn.btn-primary(id='J_restart') 重启Apache
    .box
      h3 host操作
      textarea.form-control(id='J_host',rows='10',cols='100')
      br
      button.btn.btn-info(id='J_read') 读取host
      button.btn.btn-danger(id='J_write') 写入host
    .box
      h3 vhost测试
      button.btn.btn-info(id='J_put') PUT
      button.btn.btn-danger(id='J_delete') DELETE

block footer-js
  script.
    //- $.getJSONP('/api/vhost/', function(json) {
    //-     console.log(json)
    //-   });
    $.ajax({
      url: '/api/vhost',
      type: 'get',
      dataType: 'jsonp',
      success: function(json) {
        //console.log(json);
        var text = JSON.stringify(json);
        $('#J_httpd').val(text.replace(/(\\r)?\\n/g, '\r\n'));
      }
    });
    $('#J_put').on('click', function() {
      $.ajax({
        url: '/api/vhost/localhost',
        type: 'put',
        dataType: 'jsonp',
        success: function(json) {
          console.log(json);
        }
      });
    });
    $('#J_delete').on('click', function() {
      $.ajax({
        url: '/api/vhost/qianshan.com',
        type: 'delete',
        dataType: 'jsonp',
        success: function(json) {
          console.log(json);
        }
      });
    });
    //重启apache
    $('#J_restart').on('click', function() {
      console.log('重启');
      $.ajax({
        url: '/api/apache/restart',
        type: 'post',
        dataType: 'jsonp',
        success: function(json) {
          console.log(json);
        }
      });
    });
    //host
    $('#J_read').on('click', function() {
      $.ajax({
        url: '/api/host',
        type: 'get',
        dataType: 'jsonp',
        success: function(json) {
          console.log(json);
          $('#J_host').val(json.data);
        }
      });
    });
    $('#J_write').on('click', function() {
      $.ajax({
        url: '/api/host',
        type: 'post',
        data: {
          content: $('#J_host').val()
        },
        dataType: 'jsonp',
        success: function(json) {
          console.log(json);
          $('#J_host').val(json.data);
        }
      });
    });

